<!DOCTYPE html>
<html>
  <head>
    <title>All Courses</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="/css/courses.css" />
  </head>
  <body>
    <%- include('partials/navbar') %>
    <div class="container d-flex justify-content-between my-4">
      <h1 class="h2">Courses</h1>
      <form class="d-flex align-items-center">
        <input
          class="form-control me-2"
          type="search"
          placeholder="Search"
          aria-label="Search"
        />
        <button class="btn btn-outline-success btn-sm" type="submit">
          Search
        </button>
      </form>
    </div>
    <div class="container card-container"></div>
    <a href="/add-course" class="btn add-course btn-success btn-lg m-3">
      <i class="fa-solid fa-plus"></i>
    </a>
  </body>
  <script>
    var data = <%- JSON.stringify(data) %>
    console.log(data);
    var content = ``;
    data.forEach((course)=>{
      content += `
      <div class="card mb-5">
        <h5 class="card-header bg-dark text-light">${course.courseName}</h5>
        <div class="card-body">
          <p class="card-text">${course.courseDescription}</p>
          <br>

          <div class="card-footer text-muted  d-flex justify-content-between">
            <div class="card-functionality-left">
            <a href="#" class="btn btn-primary">Ask Questions</a>
            <a href="#" class="btn btn-info mx-3">View Courses</a>
          </div>
          <div class="card-functionality-right">
            <a href="#" class="btn btn-primary"><i class="fa-solid fa-pen-to-square"></i></a>
            <a href="#" data-id = "${course._id}" class="btn btn-danger mx-3 delete-course"><i class="fa-solid fa-trash" data-id = "${course._id}"></i></a>
            </div>
          </div>


        </div>
      </div>
      `
    });
    console.log(document.querySelectorAll('.delete-course'));
    document.querySelector('.card-container').innerHTML += content;
    document.querySelectorAll('.delete-course').forEach((course)=>{
      course.addEventListener('click', (e)=>{
       const id = e.target.dataset.id;
       if(confirm(`Are you sure you want to delete this course ${id}?`))
                            {
                              fetch(`/courses/${e.target.dataset.id}`, {
                                method: 'DELETE'
                              }).then((res)=>{
                                return res.json();
                              }).then((data)=>{
                                console.log(data);
                                if(confirm(`Course ${id} deleted successfully`))
                                window.location.reload();
                              })
                            }
      })
    })
  </script>
</html>
